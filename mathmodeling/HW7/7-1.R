obj <- function(x) {
  f <- c(100 * (x[2] - x[1]^2)^2 + (1 - x[1])^2
    + 90 * (x[4] - x[3]^2)^2 + (1 - x[3])^2
    + 10 * (x[2] + x[4] - 2)^2 + 0.1 * (x[2] - x[4])^2)
  g <- matrix(c(
    -2 * (1 - x[1]) - 400 * x[1] * (-x[1]^2 + x[2]),
    200 * (-x[1]^2 + x[2]) + 0.2 * (x[2] - x[4]) +
      20 * (-2 + x[2] + x[4]), -2 * (1 - x[3]) -
      360 * x[3] * (-x[3]^2 + x[4]), -0.2 * (x[2] - x[4]) +
      20 * (-2 + x[2] + x[4]) + 180 * (-x[3]^2 + x[4])
  ), 4,1)
  print(g)

  attr(f, "gradient") <- g
  f
}

print(nlm(obj, c(-3, -1, -3, -1)))
